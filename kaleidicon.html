<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>kaleidicon</title>
		<link id="favicon" rel="icon" type="image/png" href="/favicon.png">
		<style type="text/css">
		</style>
	</head>
	<body>
		<script type="text/javascript">
			var kaleidicon = (function() {
					var ctx,
						canvas = document.createElement('canvas'),
						lines = 5,
						dim = canvas.height = canvas.width = 16,
						img = document.createElement('img'),
						faviconElement = document.getElementById('favicon'),
						body = document.getElementsByTagName('body')[0],
						getRandomRgb = function(){
							return 'rgb(' + 
									Math.floor(Math.random()*256) + ',' + 
									Math.floor(Math.random()*256) + ',' +
									Math.floor(Math.random()*256) + ')';
						},
						getRandomPoint = function(){
							return { x: Math.floor(Math.random()*dim+1), y: Math.floor(Math.random()*dim+1) }
						},
						drawRandomLine = function(){
							ctx.strokeStyle = getRandomRgb();
							var startPoint = getRandomPoint();
							var endPoint = getRandomPoint();
							ctx.beginPath();
							ctx.moveTo(startPoint.x, startPoint.y);
							ctx.lineTo(endPoint.x, endPoint.y);
							ctx.stroke();
							ctx.closePath();
							//drawReflectedLines(startPoint, endPoint);
						},
						drawReflectedLines = function(){
							// wacky math time
						};
				
				if (canvas.getContext) {

					body.appendChild(canvas);
					ctx = canvas.getContext('2d');

					// draw border
					ctx.strokeStyle = getRandomRgb();
					ctx.strokeRect(0,0,dim,dim);
					
					//var drawing = 'drawing';
					//console.time(drawing);
					
					// draw!
					for (lines; lines > 0; lines--) {
						drawRandomLine();
					}
					
					//console.timeEnd(drawing);
					
					// copy the canvas to the favicon
					faviconElement.href = canvas.toDataURL('image/png');
				}

			})();
		
		</script>
	</body>
</html>